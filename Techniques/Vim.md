# Vim

![Graphical cheat sheet](../assets/vi-vim-cheat-sheet-sch.gif)

## vim 选项

```bash
vim -r file         # 恢复上次 vim 打开时崩溃的文件
vim -R file         # 以只读方式打开
vim + file          # 将光标置于最后一行的行首
vim +n file         # 并将光标置于第 n 行的行首
vim +/pattern file  # 将光标置于第一个与 pattern 匹配的位置的行首
vim -c command file # 在对文件进行编辑前，先执行指定的命令。
```

## Vim 基本操作

[Vim 基本操作](http://c.biancheng.net/view/805.html)  

### Vim 插入文本

| 快捷键 | 功能描述           |
| :----: | :----------------- |
|  `i`   | 在当前位置插入     |
|  `I`   | 在行首插入         |
|  `o`   | 在下面插入新行     |
|  `O`   | 在上面插入新行     |
|  `a`   | 在当前位置之后插入 |
|  `A`   | 在行尾插入         |

### Vim 查找文本

| 快捷键  | 功能描述                     |
| :-----: | :--------------------------- |
| `/abc`  | 从当前位置向后查找字符串 abc |
| `?abc`  | 从当前位置向前查找字符串 abc |
| `/^abc` | 查找以 abc 为行首的行        |
| `/abc$` | 查找以 abc 为行尾的行        |
|   `n`   | 向同一方向重复上次的查找指令 |
|   `N`   | 向相反方向重复上次的查找指定 |

1. 设置忽略大小写：`:set ic`
2. 取消忽略大小写：`:set noic`
3. 如果在字符串中出现特殊符号，需要加上转义字符 `\` 。常见的特殊符号有 `\`、`*`、`?`、`$` 等。例如，要查找字符串 “10$” ，则需要在命令模式中输入 `/10\$` 。

### Vim 替换文本

|    快捷键     | 功能描述                                       |
| :-----------: | :--------------------------------------------- |
|      `r`      | 替换当前字符                                   |
|      `R`      | 进入 REPLACE 模式                              |
|   `:s/a/b`    | 将当前行中的第一个 a 替换为 b                  |
|  `:s/a/b/g`   | 将当前行中的所有 a 替换为 b                    |
|  `:s/a/b/gc`  | 将当前行中的所有 a 替换为 b ，每次替换前询问。 |
| `:1,9s/a/b/g` | 将 1 到 9 行中所有 a 替换为 b                  |
|  `:%s/a/b/g`  | 将文件中所有的 a 替换为 b                      |

> s 即 substitute
>
> 在指定行时，可以用 `.` 表示当前行，用 `$` 表示最后一行：`:.,$s/a/b/g` 将当前行到最后一行的所有 a 替换为 b 。
>
> Vim 允许自定义间隔符，比如：`:s#dir1/#dir2#g`
>
> `.` 

[简书：Vim 文本替换](https://www.jianshu.com/p/9cedcc218eb3)

[Vim 文本替换](http://c.biancheng.net/linux/Vim.html)

#### Vim 批量注释和自定义注释快捷键

```vim
:1,9s/^/#/g " 注释 1 到 9 行
:1,9s/^#//g " 取消 1 到 9 行的注释
```

```vim
:map ^P I#<Esc> " 设置 Ctrl + P 为在行首添加 # 注释
:map ^B 0x      " 删除行首字符（删除 #）
:unmap ^P       " 取消该快捷键
```

1. `^P` 使用 <kbd>Ctrl</kbd> + <kbd>V</kbd> + <kbd>P</kbd> 打出。
2. `I` 表示在行首输入，`#` 为输入内容，`<Esc>` 表示退回命令模式。
3. `0` 表示跳到行首，`x` 表示删除当前字符。

[Vim 批量注释和自定义注释快捷键](http://c.biancheng.net/view/813.html)

### Vim 删除文本

| 快捷键  | 功能描述                     |
| :-----: | :--------------------------- |
|   `x`   | 删除当前字符                 |
|  `dd`   | 删除当前行                   |
|  `3dd`  | 从当前行开始删除 3 行        |
|  `dG`   | 删除当前行及之后的所有内容   |
|   `D`   | 删除行内当前字符及之后的内容 |
| `:1,9d` | 删除 1 到 9 行的所有内容     |

> 注意，被删除的内容并没有真正删除，都放在了剪贴板中。按下 `p` 键，就可以将刚才删除的内容再粘贴到当前位置。

### Vim 拷贝和粘贴文本

| 快捷键 | 功能描述                      |
| :----: | :---------------------------- |
|  `p`   | 将剪贴板中的内容粘贴到光标后  |
|  `P`   | 将剪贴板中的内容粘贴到光标前  |
|  `y`   | 复制已选中的文本到剪贴板      |
|  `yy`  | 将当前行复制到剪贴板          |
| `3yy`  | 从当前行开始复制 3 行到剪贴板 |
|  `yw`  | 将光标位置的单词复制到剪贴板  |

### Vim 撤销和恢复

|             快捷键             | 功能                                                                     |
| :----------------------------: | :----------------------------------------------------------------------- |
|              `u`               | 撤销                                                                     |
| <kbd>Ctrl</kbd> + <kbd>R</kbd> | 重做                                                                     |
|              `U`               | 第一次会撤销对当前行做过的全部操作，第二次会重做对当前行做过的所有操作。 |

### Vim 其他常用快捷键及命令

|                                   快捷键                                    | 功能描述             |
| :-------------------------------------------------------------------------: | :------------------- |
|                                     `J`                                     | 将当前行与下一行合并 |
|                                  `:w file`                                  | 另存为 file          |
|                                  `:set nu`                                  | 显示行号             |
|                                 `:set nonu`                                 | 取消显示行号         |
|                              `:set cursorline`                              | 突出显示当前行       |
| `:set mouse=a`<br>`:set selection=exclusive`<br>`:set selectmode=mouse,key` | 启用鼠标             |
|                              `set autoindent`                               | 自动缩进             |
|                               `set tabstop=4`                               | 设置 Tab 键宽度      |
|                                 `:set all`                                  | 查看所有的设置参数   |

> `:set nu` 也可以写作 `:set number`
>
> 可以编辑 `~/.vimrc` 文件来配置 Vim 默认设置，此时命令中可以不带 `:` 。

[Vim 显示行号](http://c.biancheng.net/view/vip_5061.html)  
[Vim 配置文件](http://c.biancheng.net/view/vip_5062.html)

## Vim 移动光标

以单词为单位移动：<kbd>W</kbd> <kbd>B</kbd>

移动到行首或行尾：<kbd>$</kbd> <kbd>^</kbd> 或 <kbd>0</kbd>

移动到指定字符：`f` `F`

移动到指定行：`gg` 移动到页首；`G` 移动到页尾； `3G` 或 `:3` 移动到第 3 行

移动到匹配的括号处：<kbd>%</kbd>

## Vim 可视化模式

可视化模式用于选中文本

| 命令                           | 功能                                   |
| ------------------------------ | -------------------------------------- |
| `v`                            | 可视化模式，按一下进入，再按一下退出。 |
| `V`                            | 行可视化模式                           |
| <kbd>Ctrl</kbd> + <kbd>V</kbd> | 块可视化模式                           |

| 命令  | 功能                           |
| :---: | :----------------------------- |
|  `d`  | 删除选中的文本                 |
|  `D`  | 删除选中部分所在的行           | `y` | 将选中部分复制到剪贴板中。 |
|  `p`  | 将剪贴板中的内容粘贴到光标之后 |
|  `P`  | 将剪贴板中的内容粘贴到光标之前 |
|  `u`  | 将选中部分的内容全部改为小写   |
|  `U`  | 将选中部分的内容全部改为大写   |
|  `>`  | 将选中部分右移一个 Tab 的长度  |
|  `<`  | 将选中部分左移一个 Tab 的长度  |

## Vim 多窗口编辑模式

`:sp/file` 水平切分

`:vs/file` 垂直切分

也可以在打开 Vim 时使用 `-o` 选项直接打开两个（多个）文件：`vim -o file1 file2`

切换窗口：<kbd>Ctrl</kbd> + <kbd>W</kbd> + <kbd>W</kbd>

将一个文件的所有内容复制到当前行下面的新行：`:r file`

## Vim 执行 Linux 命令

按下 `!!` 选中当前行，执行 Linux 命令，并用执行结果覆盖选中内容。

按下 `!}` 选中当前行以及之后的所有行，执行 Linux 命令，并用执行结果覆盖选中内容。

选中的内容会作为 Linux 命令的输入

```vim
:! <command>  " 直接执行命令
:.! <command> " 选中当前行执行命令
:1,9!         " 选中 1~9 行执行命令
:w!           " 选中文件的所有内容执行命令，但命令的执行结果不会写入到文件。
:r!           " 直接执行命令，并将命令的执行结果插入到当前行下面的新行。
:3r!          " 直接执行命令，并将命令的执行结果插入到第 3 行下面的新行。
:1,9w!        " 选中 1~9 行执行命令，但命令的执行结果不会写入到文件。
```

### 实用命令

```vim
:%!sort
```